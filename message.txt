-- CONFIGURAÇÕES PERSONALIZÁVEIS
local Settings = {
    -- Geral
    GameId = 5671776994, -- ID do jogo (Counter Blox Source 2)

    -- Aimbot
    AimbotEnabled = false, -- Ativar/Desativar o Aimbot
    AimbotKey = Enum.UserInputType.MouseButton2, -- Botão para ativar o Aimbot (Botão direito do mouse)
    AimbotSmoothness = 0.1, -- Suavidade do Aimbot (0 = instantâneo, 1 = muito lento)
    AimbotFOV = 100, -- Campo de visão do Aimbot (em graus)
    AimbotTeamCheck = true, -- Ignorar membros da mesma equipe

    -- Interface Gráfica
    GuiEnabled = true, -- Ativar/desativar a interface gráfica
    GuiKeyToToggle = Enum.KeyCode.Zero, -- Tecla para ativar/desativar a GUI
}

-- Verifica se o jogo é Counter Blox Source 2
local function isCounterBloxSource2()
    return game.PlaceId == Settings.GameId
end

if not isCounterBloxSource2() then
    warn("Este script só é compatível com Counter Blox Source 2.")
    return
end

-- Serviços
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local TweenService = game:GetService("TweenService")

-- Variáveis
local LocalPlayer = Players.LocalPlayer
local Mouse = LocalPlayer:GetMouse()
local Camera = workspace.CurrentCamera

-- Criação da Interface Gráfica
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "Wgxzs Team"
ScreenGui.Parent = game.CoreGui

local Frame = Instance.new("Frame")
Frame.Size = UDim2.new(0, 350, 0, 450) -- Aumentei o tamanho para acomodar a SeekBar
Frame.Position = UDim2.new(0.5, -175, 0.5, -225)
Frame.BackgroundColor3 = Color3.fromRGB(20, 20, 20) -- Fundo preto
Frame.BackgroundTransparency = 0.2
Frame.BorderSizePixel = 0
Frame.ClipsDescendants = true
Frame.Parent = ScreenGui

-- Borda arredondada
local UICorner = Instance.new("UICorner")
UICorner.CornerRadius = UDim.new(0, 12)
UICorner.Parent = Frame

-- Título
local Title = Instance.new("TextLabel")
Title.Size = UDim2.new(1, 0, 0, 50)
Title.Text = "Wgxzs Team"
Title.Font = Enum.Font.GothamBold
Title.TextColor3 = Color3.fromRGB(255, 255, 255)
Title.TextSize = 24
Title.BackgroundTransparency = 1
Title.Position = UDim2.new(0, 0, 0, 10)
Title.Parent = Frame

-- Divisor
local Divider = Instance.new("Frame")
Divider.Size = UDim2.new(0.9, 0, 0, 1)
Divider.Position = UDim2.new(0.05, 0, 0, 60)
Divider.BackgroundColor3 = Color3.fromRGB(128, 0, 128) -- Roxo
Divider.BackgroundTransparency = 0.8
Divider.BorderSizePixel = 0
Divider.Parent = Frame

-- Botão "+"
local ConfigButton = Instance.new("TextButton")
ConfigButton.Size = UDim2.new(0, 35, 0, 39) -- Tamanho do botão
ConfigButton.Position = UDim2.new(0.9, -9, 0.2, 1) -- Posicionado no canto superior direito
ConfigButton.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
ConfigButton.Text = "+"
ConfigButton.Font = Enum.Font.GothamBold
ConfigButton.TextColor3 = Color3.fromRGB(255, 255, 255)
ConfigButton.TextSize = 24
ConfigButton.AutoButtonColor = false
ConfigButton.Parent = Frame

-- Aba de Configuração (inicialmente oculta)
local ConfigPanel = Instance.new("Frame")
ConfigPanel.Size = UDim2.new(0, 300, 0, 300)
ConfigPanel.Position = UDim2.new(0.5, -150, 0.5, -150)
ConfigPanel.BackgroundColor3 = Color3.fromRGB(20, 20, 20)
ConfigPanel.BackgroundTransparency = 0.2
ConfigPanel.BorderSizePixel = 0
ConfigPanel.Visible = false
ConfigPanel.Parent = ScreenGui

-- Borda arredondada para o painel de configuração
local UICornerConfig = Instance.new("UICorner")
UICornerConfig.CornerRadius = UDim.new(0, 12)
UICornerConfig.Parent = ConfigPanel

-- Título da aba de configuração
local ConfigTitle = Instance.new("TextLabel")
ConfigTitle.Size = UDim2.new(1, 0, 0, 40)
ConfigTitle.Text = "Configurações do Aimbot"
ConfigTitle.Font = Enum.Font.GothamBold
ConfigTitle.TextColor3 = Color3.fromRGB(255, 255, 255)
ConfigTitle.TextSize = 18
ConfigTitle.BackgroundTransparency = 1
ConfigTitle.Position = UDim2.new(0, 0, 0, 10)
ConfigTitle.Parent = ConfigPanel

-- Slider para ajustar a Suavidade do Aimbot
local SmoothnessLabel = Instance.new("TextLabel")
SmoothnessLabel.Size = UDim2.new(1, 0, 0, 30)
SmoothnessLabel.Position = UDim2.new(0, 10, 0, 60)
SmoothnessLabel.Text = "Suavidade: " .. tostring(Settings.AimbotSmoothness)
SmoothnessLabel.Font = Enum.Font.Gotham
SmoothnessLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
SmoothnessLabel.TextSize = 16
SmoothnessLabel.BackgroundTransparency = 1
SmoothnessLabel.Parent = ConfigPanel

local SmoothnessSlider = Instance.new("Frame")
SmoothnessSlider.Size = UDim2.new(1, -20, 0, 10)
SmoothnessSlider.Position = UDim2.new(0, 10, 0, 90)
SmoothnessSlider.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
SmoothnessSlider.BorderSizePixel = 0
SmoothnessSlider.Parent = ConfigPanel

local SmoothnessFill = Instance.new("Frame")
SmoothnessFill.Size = UDim2.new(Settings.AimbotSmoothness, 0, 1, 0)
SmoothnessFill.BackgroundColor3 = Color3.fromRGB(128, 0, 128)
SmoothnessFill.BorderSizePixel = 0
SmoothnessFill.Parent = SmoothnessSlider

local function updateSmoothness(value)
    Settings.AimbotSmoothness = value
    SmoothnessFill.Size = UDim2.new(value, 0, 1, 0)
    SmoothnessLabel.Text = "Suavidade: " .. tostring(math.floor(value * 100) / 100)
end

SmoothnessSlider.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 then
        local mousePos = input.Position.X
        local sliderPos = SmoothnessSlider.AbsolutePosition.X
        local sliderWidth = SmoothnessSlider.AbsoluteSize.X
        local percent = math.clamp((mousePos - sliderPos) / sliderWidth, 0, 1)
        updateSmoothness(percent)
    end
end)

-- Slider para ajustar o FOV do Aimbot
local FOVLabel = Instance.new("TextLabel")
FOVLabel.Size = UDim2.new(1, 0, 0, 30)
FOVLabel.Position = UDim2.new(0, 10, 0, 130)
FOVLabel.Text = "FOV: " .. tostring(Settings.AimbotFOV)
FOVLabel.Font = Enum.Font.Gotham
FOVLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
FOVLabel.TextSize = 16
FOVLabel.BackgroundTransparency = 1
FOVLabel.Parent = ConfigPanel

local FOVSlider = Instance.new("Frame")
FOVSlider.Size = UDim2.new(1, -20, 0, 10)
FOVSlider.Position = UDim2.new(0, 10, 0, 160)
FOVSlider.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
FOVSlider.BorderSizePixel = 0
FOVSlider.Parent = ConfigPanel

local FOVFill = Instance.new("Frame")
FOVFill.Size = UDim2.new(Settings.AimbotFOV / 360, 0, 1, 0)
FOVFill.BackgroundColor3 = Color3.fromRGB(128, 0, 128)
FOVFill.BorderSizePixel = 0
FOVFill.Parent = FOVSlider

local function updateFOV(value)
    Settings.AimbotFOV = value
    FOVFill.Size = UDim2.new(value / 360, 0, 1, 0)
    FOVLabel.Text = "FOV: " .. tostring(math.floor(value))
end

FOVSlider.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 then
        local mousePos = input.Position.X
        local sliderPos = FOVSlider.AbsolutePosition.X
        local sliderWidth = FOVSlider.AbsoluteSize.X
        local percent = math.clamp((mousePos - sliderPos) / sliderWidth, 0, 1)
        updateFOV(percent * 360)
    end
end)

local FOVCircle = Instance.new("Frame")
FOVCircle.Size = UDim2.new(0, Settings.AimbotFOV * 2, 0, Settings.AimbotFOV * 2)
FOVCircle.AnchorPoint = Vector2.new(0.5, 0.5)
FOVCircle.Position = UDim2.new(0.5, 0, 0.5, 0)
FOVCircle.BackgroundTransparency = 1
FOVCircle.BorderSizePixel = 0
FOVCircle.Parent = FOVCircleGui

local UICornerCircle = Instance.new("UICorner")
UICornerCircle.CornerRadius = UDim.new(1, 0)
UICornerCircle.Parent = FOVCircle

local FOVCircleBorder = Instance.new("UIStroke")
FOVCircleBorder.Color = Color3.fromRGB(128, 0, 128)
FOVCircleBorder.Thickness = 2
FOVCircleBorder.Parent = FOVCircle

-- Função para atualizar o círculo de FOV
local function updateFOVCircle(value)
    FOVCircle.Size = UDim2.new(0, value * 2, 0, value * 2)
end

updateFOVCircle(Settings.AimbotFOV)

-- Alternar visibilidade da aba de configuração
ConfigButton.MouseButton1Click:Connect(function()
    ConfigPanel.Visible = not ConfigPanel.Visible
end)

-- Botão Aimbot
local AimbotButton = Instance.new("TextButton")
AimbotButton.Size = UDim2.new(0.8, 0, 0, 40)
AimbotButton.Position = UDim2.new(0.05, 0, 0.2, 0)
AimbotButton.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
AimbotButton.Text = "Ativar Aimbot"
AimbotButton.Font = Enum.Font.Gotham
AimbotButton.TextColor3 = Color3.fromRGB(255, 255, 255)
AimbotButton.TextSize = 18
AimbotButton.AutoButtonColor = false
AimbotButton.Parent = Frame

-- Ícone do Aimbot
local AimbotIcon = Instance.new("ImageLabel")
AimbotIcon.Size = UDim2.new(0, 24, 0, 24)
AimbotIcon.Position = UDim2.new(0.05, 0, 0.5, -12)
AimbotIcon.Image = "rbxassetid://1234567890" -- Substitua pelo ID de uma imagem de ícone
AimbotIcon.BackgroundTransparency = 1
AimbotIcon.Parent = AimbotButton

-- Botão Silent Aim
local SilentAimButton = Instance.new("TextButton")
SilentAimButton.Size = UDim2.new(0.9, 0, 0, 40)
SilentAimButton.Position = UDim2.new(0.05, 0, 0.5, 0)
SilentAimButton.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
SilentAimButton.Text = "Ativar Silent Aim"
SilentAimButton.Font = Enum.Font.Gotham
SilentAimButton.TextColor3 = Color3.fromRGB(255, 255, 255)
SilentAimButton.TextSize = 18
SilentAimButton.AutoButtonColor = false
SilentAimButton.Parent = Frame

-- Ícone do Silent Aim
local SilentAimIcon = Instance.new("ImageLabel")
SilentAimIcon.Size = UDim2.new(0, 24, 0, 24)
SilentAimIcon.Position = UDim2.new(0.05, 0, 0.5, -12)
SilentAimIcon.Image = "rbxassetid://1234567890" -- Substitua pelo ID de uma imagem de ícone
SilentAimIcon.BackgroundTransparency = 1
SilentAimIcon.Parent = SilentAimButton

-- Função para ativar/desativar o Silent Aim
SilentAimButton.MouseButton1Click:Connect(function()
    Settings.SilentAimEnabled = not Settings.SilentAimEnabled
    SilentAimButton.Text = Settings.SilentAimEnabled and "Desativar Silent Aim" or "Ativar Silent Aim"
    print("Silent Aim " .. (Settings.SilentAimEnabled and "ativado!" or "desativado!"))
end)

-- Botão ESP
local ESPButton = Instance.new("TextButton")
ESPButton.Size = UDim2.new(0.9, 0, 0, 40)
ESPButton.Position = UDim2.new(0.05, 0, 0.4, 0)
ESPButton.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
ESPButton.Text = "Ativar ESP"
ESPButton.Font = Enum.Font.Gotham
ESPButton.TextColor3 = Color3.fromRGB(255, 255, 255)
ESPButton.TextSize = 18
ESPButton.AutoButtonColor = false
ESPButton.Parent = Frame

-- Ícone do ESP
local ESPIcon = Instance.new("ImageLabel")
ESPIcon.Size = UDim2.new(0, 24, 0, 24)
ESPIcon.Position = UDim2.new(0.05, 0, 0.5, -12)
ESPIcon.Image = "rbxassetid://1234567890" -- Substitua pelo ID de uma imagem de ícone
ESPIcon.BackgroundTransparency = 1
ESPIcon.Parent = ESPButton

-- Botão Hitbox Expansion
local HitboxButton = Instance.new("TextButton")
HitboxButton.Size = UDim2.new(0.9, 0, 0, 40)
HitboxButton.Position = UDim2.new(0.05, 0, 0.6, 0)
HitboxButton.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
HitboxButton.Text = "Ativar Hitbox Expansion"
HitboxButton.Font = Enum.Font.Gotham
HitboxButton.TextColor3 = Color3.fromRGB(255, 255, 255)
HitboxButton.TextSize = 18
HitboxButton.AutoButtonColor = false
HitboxButton.Parent = Frame

-- Ícone do Hitbox Expansion
local HitboxIcon = Instance.new("ImageLabel")
HitboxIcon.Size = UDim2.new(0, 24, 0, 24)
HitboxIcon.Position = UDim2.new(0.05, 0, 0.5, -12)
HitboxIcon.Image = "rbxassetid://1234567890" -- Substitua pelo ID de uma imagem de ícone
HitboxIcon.BackgroundTransparency = 1
HitboxIcon.Parent = HitboxButton

-- Botão Destruir
local DestroyButton = Instance.new("TextButton")
DestroyButton.Size = UDim2.new(0.9, 0, 0, 40)
DestroyButton.Position = UDim2.new(0.05, 0, 0.8, 0)
DestroyButton.BackgroundColor3 = Color3.fromRGB(200, 50, 50) -- Cor vermelha para indicar perigo
DestroyButton.Text = "Destruir"
DestroyButton.Font = Enum.Font.Gotham
DestroyButton.TextColor3 = Color3.fromRGB(255, 255, 255)
DestroyButton.TextSize = 18
DestroyButton.AutoButtonColor = false
DestroyButton.Parent = Frame

-- Ícone do Botão Destruir
local DestroyIcon = Instance.new("ImageLabel")
DestroyIcon.Size = UDim2.new(0, 24, 0, 24)
DestroyIcon.Position = UDim2.new(0.05, 0, 0.5, -12)
DestroyIcon.Image = "rbxassetid://1234567890" -- Substitua pelo ID de uma imagem de ícone
DestroyIcon.BackgroundTransparency = 1
DestroyIcon.Parent = DestroyButton

-- Efeito de hover nos botões
local function createHoverEffect(button)
    button.MouseEnter:Connect(function()
        TweenService:Create(button, TweenInfo.new(0.2), {BackgroundColor3 = Color3.fromRGB(70, 70, 70)}):Play()
    end)
end

createHoverEffect(AimbotButton)
createHoverEffect(ESPButton)
createHoverEffect(HitboxButton)
createHoverEffect(DestroyButton)

-- Função para calcular a distância entre dois pontos
local function getDistance(pointA, pointB)
    return (pointA - pointB).Magnitude
end

-- Função para verificar se um jogador é visível
local function isPlayerVisible(player)
    if not player.Character or not player.Character:FindFirstChild("Head") then
        return false
    end

    local headPosition = player.Character.Head.Position
    local cameraPosition = Camera.CFrame.Position
    local direction = (headPosition - cameraPosition).Unit

    -- Verifica se há obstáculos entre a câmera e o jogador
    local ray = Ray.new(cameraPosition, direction * 1000)
    local hit, position = workspace:FindPartOnRay(ray, LocalPlayer.Character)

    if hit and hit:IsDescendantOf(player.Character) then
        return true
    end

    return false
end

-- Função para encontrar o jogador mais próximo dentro do FOV
local function getClosestPlayer()
    local closestPlayer = nil
    local closestDistance = Settings.AimbotFOV

    for _, player in pairs(Players:GetPlayers()) do
        if player ~= LocalPlayer and player.Character and player.Character:FindFirstChild("Head") then
            -- Verifica se o jogador é da mesma equipe
            if Settings.AimbotTeamCheck and player.Team == LocalPlayer.Team then
                continue
            end

            -- Verifica se o jogador está visível
            if not isPlayerVisible(player) then
                continue
            end

            -- Calcula a distância entre o jogador e o centro da tela
            local headPosition = player.Character.Head.Position
            local screenPosition, onScreen = Camera:WorldToViewportPoint(headPosition)

            if onScreen then
                local distance = getDistance(Vector2.new(screenPosition.X, screenPosition.Y), Vector2.new(Mouse.X, Mouse.Y))

                if distance < closestDistance then
                    closestPlayer = player
                    closestDistance = distance
                end
            end
        end
    end

    return closestPlayer
end

-- Função para obter o jogador mais próximo dentro do FOV do Silent Aim
local function getClosestPlayerForSilentAim()
    local closestPlayer = nil
    local closestDistance = Settings.AimbotFOV

    for _, player in pairs(Players:GetPlayers()) do
        if player ~= LocalPlayer and player.Character and player.Character:FindFirstChild("Head") then
            -- Verifica se o jogador é da mesma equipe
            if Settings.SilentAimTeamCheck and player.Team == LocalPlayer.Team then
                continue
            end

            -- Calcula a distância entre o jogador e o centro da tela
            local headPosition = player.Character.Head.Position
            local screenPosition, onScreen = Camera:WorldToViewportPoint(headPosition)

            if onScreen then
                local distance = getDistance(Vector2.new(screenPosition.X, screenPosition.Y), Vector2.new(Mouse.X, Mouse.Y))

                if distance < closestDistance then
                    closestPlayer = player
                    closestDistance = distance
                end
            end
        end
    end

    return closestPlayer
end

-- Função para ajustar o tiro silenciosamente
local function silentAimAt(target)
    if not target or not target.Character or not target.Character:FindFirstChild("Head") then
        return
    end

    -- Obtém a posição da parte-alvo (ex.: cabeça)
    local targetPart = target.Character.Head
    local targetPosition = targetPart.Position

    -- Simula o tiro diretamente no alvo
    local cameraPosition = Camera.CFrame.Position
    local direction = (targetPosition - cameraPosition).Unit

    -- Ajusta a mira silenciosamente
    Camera.CFrame = CFrame.new(cameraPosition, targetPosition)
end

-- Função para ajustar a mira suavemente
local function aimAt(target)
    if not target or not target.Character or not target.Character:FindFirstChild("Head") then
        return
    end

    local headPosition = target.Character.Head.Position
    local cameraPosition = Camera.CFrame.Position
    local direction = (headPosition - cameraPosition).Unit

    -- Suaviza o movimento da mira
    local currentLook = Camera.CFrame.LookVector
    local newLook = currentLook:Lerp(direction, Settings.AimbotSmoothness)

    -- Ajusta a mira
    Camera.CFrame = CFrame.new(cameraPosition, cameraPosition + newLook)
end

-- Loop principal do Aimbot
RunService.RenderStepped:Connect(function()
    if Settings.AimbotEnabled and UserInputService:IsMouseButtonPressed(Settings.AimbotKey) then
        local closestPlayer = getClosestPlayer()

        if closestPlayer then
            aimAt(closestPlayer)
        end
    end
end)

-- Conectar o Silent Aim ao clique do mouse
UserInputService.InputBegan:Connect(function(input)
    if input.UserInputType == Settings.AimbotKey and Settings.SilentAimEnabled then
        local closestPlayer = getClosestPlayerForSilentAim()

        if closestPlayer then
            silentAimAt(closestPlayer)
        end
    end
end)

-- Função para ativar/desativar o Aimbot
local function toggleAimbot()
    Settings.AimbotEnabled = not Settings.AimbotEnabled
    AimbotButton.Text = Settings.AimbotEnabled and "Desativar Aimbot" or "Ativar Aimbot"
    print("Aimbot " .. (Settings.AimbotEnabled and "ativado!" or "desativado!"))
end

-- Botão Aimbot
AimbotButton.MouseButton1Click:Connect(toggleAimbot)

-- Função ESP (NameTag ESP)
local espEnabled = false
local espNameTags = {}

local function createESPNameTag(player)
    if not player.Character or not player.Character:FindFirstChild("Head") then return end

    -- Verifica se o jogador é da mesma equipe
    if Settings.AimbotTeamCheck and player.Team == LocalPlayer.Team then
        return
    end

    -- Cria um TextLabel para o NameTag
    local nameTag = Instance.new("BillboardGui")
    nameTag.Name = "NameTag"
    nameTag.Size = UDim2.new(0, 20, 0, 10) -- Tamanho do NameTag
    nameTag.StudsOffset = Vector3.new(0, 2, 0) -- Posiciona acima da cabeça
    nameTag.AlwaysOnTop = true
    nameTag.Adornee = player.Character.Head
    nameTag.Parent = player.Character.Head

    local textLabel = Instance.new("TextLabel")
    textLabel.Size = UDim2.new(1, 0, 1, 0)
    textLabel.BackgroundTransparency = 1
    textLabel.TextColor3 = Color3.fromRGB(165, 42, 42) -- Cor do texto (branco)
    textLabel.TextStrokeTransparency = 0.5 -- Contorno do texto
    textLabel.TextScaled = true
    textLabel.Text = player.Name -- Exibe o nome do jogador
    textLabel.Font = Enum.Font.GothamBold
    textLabel.Parent = nameTag

    -- Armazena o NameTag para remoção posterior
    espNameTags[player] = nameTag
end

local function removeESPNameTag(player)
    if espNameTags[player] then
        espNameTags[player]:Destroy()
        espNameTags[player] = nil
    end
end

ESPButton.MouseButton1Click:Connect(function()
    espEnabled = not espEnabled
    ESPButton.Text = espEnabled and "Desativar ESP" or "Ativar ESP"
    if espEnabled then
        print("ESP NameTag ativado!")
        for _, player in pairs(Players:GetPlayers()) do
            if player ~= LocalPlayer then
                createESPNameTag(player)
            end
        end
    else
        print("ESP NameTag desativado!")
        for player, _ in pairs(espNameTags) do
            removeESPNameTag(player)
        end
    end
end)

-- Detectar quando novos jogadores entram no jogo
Players.PlayerAdded:Connect(function(player)
    if espEnabled and player ~= LocalPlayer then
        createESPNameTag(player)
    end
end)

-- Detectar quando jogadores saem do jogo
Players.PlayerRemoving:Connect(function(player)
    if espNameTags[player] then
        removeESPNameTag(player)
    end
end)

-- Função Hitbox Expansion
local hitboxEnabled = false
local hitboxExpanders = {}

local function createHitboxExpander(player)
    if not player.Character or not player.Character:FindFirstChild("HumanoidRootPart") then return end

    local RootPart = player.Character.HumanoidRootPart
    local HitboxExpander = Instance.new("Part")
    HitboxExpander.Name = "HitboxExpander"
    HitboxExpander.Size = Vector3.new(10, 10, 10) -- Tamanho da hitbox expandida
    HitboxExpander.Color = Color3.fromRGB(255, 0, 0)
    HitboxExpander.Transparency = 0.5
    HitboxExpander.CanCollide = true
    HitboxExpander.Anchored = false
    HitboxExpander.Massless = true
    HitboxExpander.Parent = player.Character

    local Weld = Instance.new("WeldConstraint")
    Weld.Part0 = RootPart
    Weld.Part1 = HitboxExpander
    Weld.Parent = HitboxExpander

    hitboxExpanders[player] = HitboxExpander
end

local function removeHitboxExpander(player)
    if hitboxExpanders[player] then
        hitboxExpanders[player]:Destroy()
        hitboxExpanders[player] = nil
    end
end

HitboxButton.MouseButton1Click:Connect(function()
    hitboxEnabled = not hitboxEnabled
    HitboxButton.Text = hitboxEnabled and "Desativar Hitbox Expansion" or "Ativar Hitbox Expansion"
    if hitboxEnabled then
        print("Hitbox Expansion ativado!")
        for _, player in pairs(Players:GetPlayers()) do
            if player ~= LocalPlayer then
                createHitboxExpander(player)
            end
        end
    else
        print("Hitbox Expansion desativado!")
        for player, _ in pairs(hitboxExpanders) do
            removeHitboxExpander(player)
        end
    end
end)

-- Função para destruir o script e limpar rastros
local function destroyScript()
    -- Desativa todas as funcionalidades
    Settings.AimbotEnabled = false
    espEnabled = false
    hitboxEnabled = false

    -- Remove todos os ESPs
    for player, _ in pairs(espNameTags) do
        removeESPNameTag(player)
    end

    -- Remove todas as hitboxes expandidas
    for player, _ in pairs(hitboxExpanders) do
        removeHitboxExpander(player)
    end

    -- Destrói a interface gráfica
    ScreenGui:Destroy()
    FOVCircleGui:Destroy()

    -- Limpa qualquer outro rastro do script
    print("Script destruído e todos os rastros foram limpos.")
end

-- Botão Destruir
DestroyButton.MouseButton1Click:Connect(destroyScript)

-- Função para mover a interface
local dragging
local dragInput
local dragStart
local startPos

local function update(input)
    local delta = input.Position - dragStart
    Frame.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
end

Frame.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
        dragging = true
        dragStart = input.Position
        startPos = Frame.Position

        input.Changed:Connect(function()
            if input.UserInputState == Enum.UserInputState.End then
                dragging = false
            end
        end)
    end
end)

Frame.InputChanged:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch then
        dragInput = input
    end
end)

UserInputService.InputChanged:Connect(function(input)
    if input == dragInput and dragging then
        update(input)
    end
end)

-- Função para fechar a interface com a tecla configurável
UserInputService.InputBegan:Connect(function(input, gameProcessed)
    if input.KeyCode == Settings.GuiKeyToToggle and not gameProcessed then
        ScreenGui.Enabled = not ScreenGui.Enabled
        print("Interface " .. (ScreenGui.Enabled and "reaberta." or "fechada."))
    end
end)
